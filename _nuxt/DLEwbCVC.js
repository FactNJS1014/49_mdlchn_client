import{d as L,r as o,o as P,x as Q,B as l,C as t,a0 as A,aa as h,ah as F,ab as d,y as j,a6 as U,D as i,L as w,Q as z,R as G,U as W,W as p,z as v,X as c,a4 as f,ao as $,a5 as X,A as q,as as H,a7 as J}from"#entry";import{S as x}from"./Bj_ZQUAw.js";const K={class:"flex justify-center items-center"},ee=L({__name:"appMaster",setup(O){const M=o([]),_=o([]),V=o([]),r=o([]),S=o([]),E=o([]),m=o([]),u=o(!1),n=o({level:0,empnos:[]}),C=[{title:"ลำดับ",value:"MASTER_SEQ"},{title:"ชื่อพนักงาน",value:"MASTER_NAME"},{title:"Actions",value:"actions",sortable:!1}],D=async()=>{const a={levels:[{level:1,empnos:M.value},{level:2,empnos:_.value},{level:3,empnos:V.value}]},e=await d.post("http://172.22.64.11/49_modelchange/49_mdlchn_api/api/insert/master",a);console.log(e.data),e.data.success===!0&&x.fire({icon:"success",title:"บันทึกสำเร็จ",showConfirmButton:!1,timer:1500,timerProgressBar:!0}).then(()=>{location.reload()})},T=async()=>{const a=await d.get("http://172.22.64.11/49_modelchange/49_mdlchn_api/api/users");r.value=a.data.AM,S.value=a.data.QC,E.value=a.data.ALL},b=async()=>{const a=await d.get("http://172.22.64.11/49_modelchange/49_mdlchn_api/api/approve/users");console.log(a.data),m.value=a.data},y=()=>{m.value=m.value.map(a=>{if(!a.MASTER_EMPID)return a;const s=a.MASTER_EMPID.split(",").map(g=>{const R=E.value.find(k=>k.MUSR_ID===g.trim());return R?R.MUSR_NAME:g});return console.log(s),{...a,MASTER_NAME:s.join(", ")}})},I=a=>a==1||a==2?r.value:a==3?S.value:[],N=a=>{n.value.level=a.MASTER_SEQ,n.value.empnos=a.MASTER_EMPID?a.MASTER_EMPID.split(","):[],u.value=!0},B=async()=>{const a={levels:[{level:n.value.level,empnos:n.value.empnos}]};(await d.put("http://172.22.64.11/49_modelchange/49_mdlchn_api/api/update/master",a)).data.success===!0&&(u.value=!1,x.fire({icon:"success",title:"แก้ไขสำเร็จ",showConfirmButton:!1,timer:1500,timerProgressBar:!0}).then(async()=>{await b(),await y()}))};return P(async()=>{await T(),await b(),await y()}),(a,e)=>(j(),Q(F,null,[l(A,{class:"pa-4"},{default:t(()=>[l(U,null,{default:t(()=>[...e[6]||(e[6]=[i("สร้างสายอนุมัติ 3 ลำดับ",-1)])]),_:1}),l(w,null,{default:t(()=>[l(z,{ref:"formRef",onSubmit:G(D,["prevent"])},{default:t(()=>[l(W,null,{default:t(()=>[l(p,{cols:"12",sm:"6"},{default:t(()=>[e[7]||(e[7]=v("div",{class:"mt-3 font-semibold text-xl bg-cyan-lighten-3 pa-1"}," ลำดับที่ 1: AM Sub Leader ",-1)),l(c,{modelValue:M.value,"onUpdate:modelValue":e[0]||(e[0]=s=>M.value=s),items:r.value,"item-title":"MUSR_NAME","item-value":"MUSR_ID",variant:"outlined",label:"ลำดับที่ 1 (เลือกหลายคน)",multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1}),l(p,{cols:"12",sm:"6"},{default:t(()=>[e[8]||(e[8]=v("div",{class:"mt-3 font-semibold text-xl bg-cyan-lighten-1 pa-1"}," ลำดับที่ 2: AM Leader ",-1)),l(c,{modelValue:_.value,"onUpdate:modelValue":e[1]||(e[1]=s=>_.value=s),items:r.value,"item-title":"MUSR_NAME","item-value":"MUSR_ID",variant:"outlined",label:"ลำดับที่ 2 (เลือกหลายคน)",multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1}),l(p,{cols:"12",sm:"6"},{default:t(()=>[e[9]||(e[9]=v("div",{class:"mt-3 font-semibold text-xl bg-teal-accent-3 pa-1"}," ลำดับที่ 3: QC ",-1)),l(c,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=s=>V.value=s),items:S.value,"item-title":"MUSR_NAME","item-value":"MUSR_ID",variant:"outlined",label:"ลำดับที่ 3 (เลือกหลายคน)",multiple:"",chips:"",clearable:""},null,8,["modelValue","items"])]),_:1}),l(p,{cols:"12",class:"mt-4"},{default:t(()=>[v("div",K,[l(f,{color:"primary",type:"submit",rounded:"lg",width:"300px","prepend-icon":"mdi mdi-content-save-settings"},{default:t(()=>[...e[10]||(e[10]=[i("บันทึก",-1)])]),_:1})])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1}),l(A,{class:"mt-4 pa-4"},{default:t(()=>[l($,{items:m.value,headers:C,class:"mt-4"},{"item.actions":t(({item:s})=>[l(f,{icon:"",color:"warning",onClick:g=>N(s),size:"small",rounded:"lg"},{default:t(()=>[l(X,null,{default:t(()=>[...e[11]||(e[11]=[i("mdi-account-edit",-1)])]),_:1})]),_:1},8,["onClick"])]),_:1},8,["items"])]),_:1}),l(h,{modelValue:u.value,"onUpdate:modelValue":e[5]||(e[5]=s=>u.value=s),width:"600"},{default:t(()=>[l(A,null,{default:t(()=>[l(U,{class:"text-h6"},{default:t(()=>[i(" แก้ไขการอนุมัติในลำดับที่ "+q(n.value.level),1)]),_:1}),l(w,null,{default:t(()=>[l(c,{modelValue:n.value.empnos,"onUpdate:modelValue":e[3]||(e[3]=s=>n.value.empnos=s),items:I(n.value.level),"item-title":"MUSR_NAME","item-value":"MUSR_ID",label:"เลือกพนักงาน",multiple:"",chips:"",clearable:"",variant:"outlined"},null,8,["modelValue","items"])]),_:1}),l(H,null,{default:t(()=>[l(J),l(f,{variant:"text",onClick:e[4]||(e[4]=s=>u.value=!1)},{default:t(()=>[...e[12]||(e[12]=[i("ยกเลิก",-1)])]),_:1}),l(f,{color:"primary",onClick:B},{default:t(()=>[...e[13]||(e[13]=[i("บันทึก",-1)])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{ee as default};
